---
import type { CollectionEntry } from 'astro:content';

import ArrowRightIcon from '../../assets/icons/arrow-right.svg';
import RssIcon from '../../assets/icons/rss.svg';

type Props = {
  latestPosts: CollectionEntry<'posts'>[];
  githubProfileLink: string;
};

const { latestPosts, githubProfileLink } = Astro.props;
---

<section id="blog" class="py-12 md:py-16 bg-background-subtle">
  <div class="container">
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-8">
      <div>
        <span class="section-label mb-3">04 â€” Writing</span>
        <div class="flex items-center gap-3">
          <h2 class="text-foreground">Latest articles</h2>
          <a
            href="/rss.xml"
            class="p-2 text-foreground-tertiary rss-pulse"
            aria-label="RSS Feed"
            title="Subscribe via RSS"
          >
            <RssIcon class="w-5 h-5" />
          </a>
        </div>
      </div>
      <a href="/blog" class="link-underline text-sm inline-flex items-center gap-2">
        View all posts
        <ArrowRightIcon class="w-4 h-4" />
      </a>
    </div>

    {latestPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        {latestPosts.map((post) => (
          <article class="card card-lift group">
            <a href={`/blog/${post.id}`} class="block p-5">
              <div class="flex flex-wrap gap-2 mb-4">
                {post.data.tags.slice(0, 2).map((tag: string) => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
              <h3 class="font-display font-semibold text-foreground mb-3 group-hover:text-accent transition-colors">
                {post.data.title}
              </h3>
              <p class="text-sm text-foreground-secondary line-clamp-2 mb-4">{post.data.description}</p>
              <time class="text-xs font-mono text-foreground-tertiary">
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                })}
              </time>
            </a>
          </article>
        ))}
      </div>
    ) : (
      <div class="card p-10 text-center">
        <p class="text-foreground-secondary">
          Articles coming soon. In the meantime, check out my{' '}
          <a
            href={githubProfileLink}
            class="text-accent hover:underline"
            target="_blank"
            rel="noopener noreferrer"
          >
            GitHub
          </a>{' '}
          for open source contributions.
        </p>
      </div>
    )}
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
